<!DOCTYPE html>        
<html lang="id">        
<head>        
  <meta charset="UTF-8" />        
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">        
<!-- Web App Manifest -->        
<link rel="manifest" href="manifest.json" />        
        
<!-- App Icons -->        
<link rel="icon" type="image/png" sizes="192x192" href="assets/icon-192.png" />        
<link rel="icon" type="image/png" sizes="512x512" href="assets/icon-512.png" />        
        
<!-- Android Theme -->        
<meta name="theme-color" content="#000000" />        
<meta name="mobile-web-app-capable" content="yes" />        
        
<!-- iOS support -->        
<meta name="apple-mobile-web-app-capable" content="yes" />        
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />        
<meta name="apple-mobile-web-app-title" content="JamYZ" />        
<meta name="color-scheme" content="dark light">
<link rel="apple-touch-icon" href="assets/icon-192.png" />        
<link rel="apple-touch-startup-image" href="assets/splash-screen.png">    
  <title>YudaTimeÂ® Neon Glass</title>        
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative&family=Great+Vibes&family=Cormorant+Garamond&display=swap" rel="stylesheet">     
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative&family=Great+Vibes&family=Cormorant+Garamond&display=swap"> 
<meta name="description" content="Jam Digital Neon Glass - Tampilan stylish, offline support, dan installable.">
	<link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />  
    <noscript>
  <strong>JavaScript dibutuhkan agar situs ini bisa berjalan offline.</strong>
</noscript>
  <style>        
    * {  
      margin: 0;  
      padding: 0;  
      box-sizing: border-box;  
    }  
    
    * {
    will-change: auto;
    transform: translateZ(0); /* Reduce GPU overuse */
  }

  video, canvas, img {
    filter: brightness(95%);
  }
    
:root {
  --color-primary: rgba(0, 255, 238, 0.08);       /* soft glass base */
  --color-accent: #ff4de8;
  --color-background: linear-gradient(120deg, #0e0e0e, #1a1a1a);
  --shadow-depth: 0 10px 32px rgba(0, 255, 255, 0.15);
  --glow-effect: 0 0 12px rgba(0, 255, 238, 0.6);

  --glass-blur: blur(18px);
  --border-glass: rgba(255, 255, 255, 0.1);
  --color-glow: rgba(0, 255, 238, 0.25);
}

body {
  background-image: var(--color-background), url('assets/bg.jpg');
  background-size: cover, cover;
  background-position: center, center;
  background-repeat: no-repeat, no-repeat;
  background-attachment: fixed, fixed;
  color: white;
  font-family: 'Poppins', sans-serif;
  filter: contrast(105%) saturate(115%) brightness(1.03);
  margin: 0;
  padding: 0;
}

/* Retina Glass Card */
.glass-retina {
  background: var(--color-primary);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--border-glass);
  border-radius: 20px;
  box-shadow:
    inset 0 0 0.5px rgba(255, 255, 255, 0.1),
    0 4px 16px var(--color-glow),
    0 8px 24px rgba(0, 0, 0, 0.2);
  padding: 24px;
  transition: all 0.4s ease;
}

/* Hover effect (optional) */
.glass-retina:hover {
  transform: scale(1.02);
  box-shadow:
    inset 0 0 1px rgba(255, 255, 255, 0.15),
    0 6px 28px rgba(0, 255, 238, 0.35),
    0 12px 36px rgba(0, 0, 0, 0.3);
}

/* 3D Card Base */
.card-3d {
  box-shadow: var(--shadow-depth);
  transform: perspective(900px) rotateX(2deg);
  backdrop-filter: blur(12px) brightness(1.08);
  border-radius: 16px;
  padding: 20px;
  transition: all 0.4s ease;
}

  .visual-mode-all {
    filter:
      hue-rotate(5deg)
      saturate(1.6)
      contrast(1.2)
      brightness(1.1)
      contrast(1.1)
      brightness(0.95)
      saturate(1.2)
      brightness(1.3)
      contrast(1.25)
      saturate(1.4);
    transform: perspective(1000px) rotateX(2deg);
    border-radius: 12px;
    transition: all 0.5s ease;
  }

    html, body {  
  width: 100%;
  height: 100%;
  display: flex;
      overflow: hidden;  
      font-family: 'Segoe UI', sans-serif;  
        height: calc(var(--vh, 1vh) * 100);
            image-rendering: optimizeSpeed;
    scroll-behavior: smooth;
    -webkit-tap-highlight-color: transparent;
    }  
    
    body, html {
  height: 100%;
}

.bg-media {
  position: fixed;      /* Nempel di layar */
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;        /* Full tinggi layar */
  z-index: -1;          /* Di belakang konten */
  overflow: hidden;
  pointer-events: none; /* Biar nggak ganggu klik */
    object-fit: cover;    /* Potong rapi, tetap proporsional */
  object-position: center;
}

  .fullscreen-wrapper {      
  	      height: 100%;  
      width: 100%;  
  display: flex;      
  justify-content: center;      
  align-items: center;     
  flex: 1;  
  border-radius: 0;      
}      

.wrapper {
	      position: relative;      
  background: transparent;      
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  width: 100%;
  height: 100%;
}
      
    .bg-fullscreen {  
  position: fixed;  
  top: 0;  
  left: 0;  
  	      height: 100%;  
      width: 100%;  
  object-fit: cover;  
  z-index: -1;  
}  
      
body {  
    width: 100%;
  height: 100vh;  
  display: flex;  
  justify-content: center;  
  align-items: center;  
  overflow: hidden;  
  padding-top: env(safe-area-inset-top);  
  padding-bottom: env(safe-area-inset-bottom);  
  padding-left: env(safe-area-inset-left);  
  padding-right: env(safe-area-inset-right);  
      z-index: 0;  
  flex-direction: column; /* Biar vertikal */
  position: relative;
}  

    .clock {      
      position: relative;      
      width: 280px;      
      height: 280px;      
      border-radius: 50%;      
      backdrop-filter: #0ff;      
      box-shadow: 0 8px 30px rgba(255,255,255,0.08), inset 0 0 25px rgba(255,255,255,0.08);      
      border: 4px solid rgba(255,255,255,0.1);      
  background-color: transparent;      
  color: white; /* atau warna neon/glow */      
  font-size: 4em;      
  text-shadow: 0 0 10px cyan; /* biar glow kayak jam digital */      
}      
      
.container {      
  background-color: transparent;      
  pointer-events: none; /* kalau konten bukan interaktif */      
    transition: all 0.3s ease-in-out;  
}      
      
.outlined {      
  color: #111; /* atau fill: #111 jika SVG */      
  text-shadow:      
    -1px -1px 1px #fff,      
     1px -1px 1px #fff,      
    -1px  1px 1px #fff,      
     1px  1px 1px #fff;      
}      
      
    .center {      
      position: absolute;      
      width: 12px;      
      height: 12px;      
      background: #fff;      
      border: 2px solid #000;      
      border-radius: 50%;      
      top: 50%;      
      left: 50%;      
      transform: translate(-50%, -50%);      
      z-index: 10;      
    }      
      
    .hand {      
      position: absolute;      
      top: 50%;      
      left: 50%;      
      transform-origin: bottom center;      
      transform: rotate(0deg);      
      border-radius: 4px;      
    }      
      
    .hour {      
      width: 6px;      
      height: 60px;      
      z-index: 3;      
    }      
          
     .hour, .minute {      
      background: #0ff;      
      box-shadow: 0 0 8px #0ff;      
    }      
      
    .minute {      
      width: 4px;      
      height: 90px;      
      z-index: 2;      
    }      
      
/* Gaya dasar */
.date-info {
  position: absolute;
  bottom: 13px;
  left: 52%;
  transform: translateX(-50%);
  padding: 6px 12px;
  font-size: 13px;
  font-family: 'Cormorant Garamond', serif;
  letter-spacing: 0.5px;
  font-weight: 500;
  text-shadow: 0 0 4px #000;
  color: #fff; /* default putih */
  background: rgba(0, 0, 0, 0.0); /* biar ada kontras */
  border-radius: 6px;
  z-index: 20;
}

    .brand-name {      
      position: absolute;      
      top: 50px;      
      left: 53%;      
      transform: translateX(-50%);      
      font-size: 30px;      
      font-weight: 500;      
color: #f5f5f5;       
text-shadow:      
  0 0 3px #fff,      
  0 0 5px #aaa,      
  1px 1px 2px rgba(0,0,0,0.6);      
      font-family: 'Cinzel Decorative', cursive;      
    }      
      
    .circular-text {      
      position: absolute;      
      width: 400px;      
      height: 400px;      
      top: 50%;      
      left: 50%;      
      transform: translate(-50%, -50%);      
      pointer-events: none;      
        fill: #00ffff; /* Warna biru terang */
          font-weight: bold;
    fill: white; /* default terang */
  transition: all 0.3s ease-in-out;
  mix-blend-mode: difference; /* bikin adaptif sama bg */
filter: drop-shadow(0 0 0.2px rgba(173, 255, 255, 0.18))
        drop-shadow(0 0 1.6px rgba(200, 255, 255, 0.07))
    }      

    .circular-text svg {      
      transform-origin: center;      
    }      

svg text {      
  font-weight: 600;      
  fill: #111; /* warna utama huruf */      
      stroke: rgba(255, 255, 255, 0.3); /* putih transparan */      
  stroke-width: 0.1px;      
  paint-order: stroke;      
  text-shadow:      
    0 0 1px #000, /* menjaga tajam di bg gelap */      
  font-size: 14px;      
  font-family: 'Great Vibes', cursive;      
  letter-spacing: 3px;      
}      
      
    .pulse-ring {      
      position: absolute;      
      width: 100%;      
      height: 100%;      
      border-radius: 50%;      
       box-shadow: none;      
      animation: none;      
    }      
          
.numeral {      
  position: absolute;      
  width: 30px;      
  height: 30px;      
  text-align: center;      
  line-height: 30px;      
  font-weight: bold;      
  color: #0ff;      
  font-size: 14px;      
  font-family: 'Cinzel Decorative', cursive;      
  transform: translate(-50%, -50%);      
  text-shadow: 0 0 6px #0ff;      
  will-change: text-shadow;      
}      
      
.clock::after {      
  content: "";      
  position: absolute;      
  top: 28px;      
  left: 28px;      
  width: 48%;      
  height: 16%;      
  background: radial-gradient(ellipse at top left, rgba(255,255,255,0.04), transparent);      
  border-radius: 50%;      
  filter: blur(0.5px);      
  opacity: 0.25;      
  pointer-events: none;      
}      
      
@keyframes pulse {      
  0% {      
    text-shadow: 0 0 6px #0ff;      
    opacity: 0.8;      
  }      
  50% {      
    text-shadow: 0 0 14px #0ff;      
    opacity: 1;      
  }      
      
  100% {      
    text-shadow: 0 0 6px #0ff;      
    opacity: 0.8;      
  }      
}      

body.locked {  
  overflow: hidden;  
}  

  .quote-container {
    position: absolute;
    top: calc(100% + 15px); /* Di bawah jam */
    width: 100%;
    text-align: center;
    padding: 10px;
    z-index: 10;
        margin-top: 30px;
          animation: fadeInBox 1s ease-out;
  }

  .quote-line {
    font-family: 'Cormorant Garamond', serif;
    font-size: 20px;
    color: #f5f5f5;
    margin: 0;
    white-space: pre-line;
    min-height: 60px;
      transition: opacity 0.5s ease-in-out;
  }

  .quote-author {
    font-family: 'Great Vibes', cursive;
    font-size: 24px;
    color: #12c2e9;
  font-weight: 500;
    margin-top: 10px;
      transition: opacity 0.5s ease-in-out;
        text-shadow: 0 0 8px rgba(255,255,255,0.4); /* glow halus */
  }

@keyframes fadeInBox {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

#typedQuote, #quoteAuthor {
  transition: opacity 1.2s ease; /* halus fade */
  opacity: 1;
}

  #typedQuote {
background: linear-gradient(90deg, #12c2e9, #c471ed, #f64f59);
  text-shadow: 0 0 8px rgba(255,255,255,0.4); /* glow halus */
      white-space: pre-line;
  transition: opacity 0.5s ease;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 600;
    color: #f0f0f0; /* Ubah ini sesuai selera kamu */
    font-family: 'Poiret One', cursive; /* Atau font sebelumnya yang kamu suka */
    font-size: 1.0rem;
    text-align: center;
    line-height: 1.6;
  }
  
    @supports (backdrop-filter: blur(10px)) {
  .glass {
    backdrop-filter: blur(10px);
  }
}
  
    .glass {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  box-shadow: 0 0 30px rgba(0, 200, 255, 0.3);
  border-radius: 15px;
}
  
  .dynamic-light {
  background: radial-gradient(circle at var(--x) var(--y), rgba(255,255,255,0.1), transparent 80%);
}

#realisticPlayer {
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  filter: brightness(1.1) contrast(1.25) saturate(1.15)
          drop-shadow(0 0 30px rgba(0,255,255,0.1))
          drop-shadow(0 0 40px rgba(255,255,255,0.05))
          blur(0.3px);
  transition: all 1s ease-in-out;
  background: radial-gradient(circle at center, #111 10%, #000 100%);
}

.brand-name {
  position: absolute;
  top: 30px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  justify-content: center;
  align-items: center;
}

    </style>      
</head>      

<body onclick="enterFullscreenOnce()" style="margin:0; overflow:hidden;">      
	<!-- Tombol Lock/Unlock -->
<button id="screenLockBtn" title="Kunci layar" style="  
  font-size: 28px;
  background: none;
  border: none;
  color: #fff;
  position: absolute;
  bottom: 12px;
  right: 12px;
  cursor: pointer;
  z-index: 100;
  transition: transform 0.2s ease;
    display: none;
">ð</button>

<!-- Layar lock overlay -->
<div id="screenLockOverlay" style="  
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.1);
  z-index: 99;
  pointer-events: all;
"></div>

<!-- Background div di belakang canvas -->
<div id="clockBg" style="
  position:absolute;
  width:300px;
  height:300px;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  border-radius:50%;
  overflow:hidden;
  z-index:0;
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
"></div>

<canvas id="clockCanvas" width="300" height="300" style="
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  border-radius:50%;
  z-index:1;
  background:none;
"></canvas>


<div class="retina-glass">
	<div id="visualMode" class="content-overlay visual-mode-all">
		
<div class="bg-cover"></div>  
<div class="content">  
	<div class="bg-vivid"></div>  
<div class="glass-mask"></div>  
	    <div class="fullscreen-wrapper">    
  <div class="wrapper">    

    <div class="circular-text" id="circularText">      
      <svg viewBox="0 0 400 400">      
        <path id="circlePath" fill="none" d="M200,200 m-160,0 a160,160 0 1,1 320,0 a160,160 0 1,1 -320,0"/>      
        <text>      
          <textPath xlink:href="#circlePath">      
            â¦ My attitude depends on who you are â¦ My attitude depends on who you are â¦ My attitude depends on who you are â¦ -2025-       
          </textPath>      
        </text>      
      </svg>      
    </div>      
      
    <div class="clock">      
      <div class="pulse-ring"></div>      
      <div class="center"></div>      
      <div class="hand hour" id="hourHand"></div>      
      <div class="hand minute" id="minuteHand"></div>      
      <div id="numerals"></div>      
<div class="brand-name" style="display:flex; flex-direction:column; align-items:center; justify-content:center;">
  <!-- Logo utama -->
  <svg viewBox="0 0 500 150" width="240" height="100">
    <defs>
      <path id="logoCurveTop" d="M 50 100 Q 250 0 450 100" fill="none"/>
    </defs>

    <text font-size="38" font-family="Arial, sans-serif" fill="#fff">
      <textPath href="#logoCurveTop" startOffset="50%" text-anchor="middle">
        CorE-YÂ²
      </textPath>
    </text>
  </svg>

<div id="daily-tagline" class="brand-tagline" 
     style="text-align:center; 
            font-family:Arial, sans-serif; 
            font-size:8px; 
            color:#00FFFF; 
            font-weight:200; 
            line-height:1; 
            transform:translateY(-50px);
            text-shadow: 0 0 2px #000;
            opacity:0;"> <!-- Mulai dari transparan -->
</div>

</div>
      <div class="date-info" id="dateInfo"></div>      
    </div>      
  </div>      
  
  
  
<!-- Input file disembunyikan -->      
<input id="bgUpload" type="file" accept="image/*,video/mp4"style="display: none;">

<!-- Quotes Box -->
<div id="quoteBox" class="quote-container">
<p id="typedQuote" class="quote-line typing"></p>
<p id="quoteAuthor" class="quote-author"></p>
</div>

<!-- Audio Alarm Ping (online, dikomentarin dulu) -->
<audio id="alarmSound" src="https://raw.githubusercontent.com/yuda2525/jamY-Z/main/quote-ping.mp3" preload="auto"></audio> 

<audio id="jamAudio" preload="auto"></audio>




<!-- Script Three.js -->
<canvas id="hiddenCanvas" style="display: none;"></canvas>
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
  <script>      
  	window.addEventListener("error", e => console.error("â Global Error:", e.message));      
const romanNumerals = [      
  "I", "II", "III", "IV", "V", "", // kosongin VI      
  "VII", "VIII", "IX", "X", "XI", "XII"      
];      
      
    const numeralContainer = document.getElementById("numerals");      
      
    romanNumerals.forEach((num, i) => {      
      const angle = (i * 30 - 60) * Math.PI / 180;      
      const radius = 115;      
      const x = 140 + radius * Math.cos(angle);      
      const y = 140 + radius * Math.sin(angle);      
      
      const div = document.createElement("div");      
      div.className = "numeral";      
      div.style.left = `${x}px`;      
      div.style.top = `${y}px`;      
      div.innerText = num;      
      numeralContainer.appendChild(div);      
    });      
      
function updateClock() {      
  const now = new Date();      
  const sec = now.getSeconds();      
  const min = now.getMinutes();      
  const hr = now.getHours() % 12;      
      
  const minAngle = min * 6 + sec * 0.1;      
  const hrAngle = hr * 30 + min * 0.5;      
      
  document.getElementById('minuteHand').style.transform = `translate(-50%, -100%) rotate(${minAngle}deg)`;      
  document.getElementById('hourHand').style.transform = `translate(-50%, -100%) rotate(${hrAngle}deg)`;      
      
  // Rotate circular quote per detik (sync)      
  const rotateDegree = sec * 6;      
  document.querySelector('.circular-text svg').style.transform = `rotate(${rotateDegree}deg)`;      
      
// Trigger pulse on numerals every second      
const numerals = document.querySelectorAll('.numeral');      
numerals.forEach(num => {      
  num.style.animation = 'none';      
  num.offsetHeight; // Trigger reflow      
  num.style.animation = 'pulse 1s ease-in-out';      
});      
      
  // Date      
  const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];  
  const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];  
  const day = days[now.getDay()];      
  const date = now.getDate();      
  const month = months[now.getMonth()];      
  const year = now.getFullYear();      
  document.getElementById('dateInfo').innerText = `${day}, ${date} ${month} ${year}`;      
}      
      
function loopClock() {
  updateClock();
  setTimeout(() => requestAnimationFrame(loopClock), 1000);
}
requestAnimationFrame(loopClock);

    updateClock();      
      
      
// ==================== FULLSCREEN LOGIC ====================
let fullscreenActivated = false;

function goFullscreen() {
  if (fullscreenActivated) return;
  fullscreenActivated = true;

  const el = document.documentElement;
  if (el.requestFullscreen) el.requestFullscreen();
  else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
  else if (el.msRequestFullscreen) el.msRequestFullscreen();
}

function forceFullscreen() {
  const el = document.documentElement;
  if (!document.fullscreenElement) {
    if (el.requestFullscreen) el.requestFullscreen();
    else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    else if (el.msRequestFullscreen) el.msRequestFullscreen();
  }
}

// Klik pertama â aktifin fullscreen
document.addEventListener("click", goFullscreen, { once: true });

// ==================== BACKGROUND LOGIC ====================
const bgUpload = document.getElementById("bgUpload");
const clockCanvas = document.getElementById("clockCanvas");
const clockBg = document.getElementById("clockBg");
let lastTap = 0;
let videoEl = null;

// IndexedDB setup buat video
const DB_NAME = "BgMediaDB";
const STORE_NAME = "videos";

// buka DB
function openDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(DB_NAME, 1);
    req.onupgradeneeded = e => {
      const db = e.target.result;
      if (!db.objectStoreNames.contains(STORE_NAME)) {
        db.createObjectStore(STORE_NAME);
      }
    };
    req.onsuccess = e => resolve(e.target.result);
    req.onerror = e => reject(e);
  });
}

async function saveVideo(file) {
  const db = await openDB();
  return new Promise((resolve, reject) => {
    const tx = db.transaction(STORE_NAME, "readwrite");
    tx.objectStore(STORE_NAME).put(file, "bgOuterVideo");
    tx.oncomplete = () => resolve();
    tx.onerror = e => reject(e);
  });
}

async function loadVideo() {
  const db = await openDB();
  return new Promise((resolve, reject) => {
    const tx = db.transaction(STORE_NAME, "readonly");
    const req = tx.objectStore(STORE_NAME).get("bgOuterVideo");
    req.onsuccess = () => resolve(req.result);
    req.onerror = e => reject(e);
  });
}

// Load background dari localStorage / IndexedDB
window.addEventListener("load", async () => {
  const bgOuter = localStorage.getItem("bgOuter");
  const bgInner = localStorage.getItem("bgInner");
  const bgOuterType = localStorage.getItem("bgOuterType");

  if (bgOuterType === "image" && bgOuter) {
    setImageBackground(bgOuter);
  } else if (bgOuterType === "video") {
    const file = await loadVideo();
    if (file) {
      const url = URL.createObjectURL(file);
      setVideoBackground(url);
    }
  }

  if (bgInner) clockBg.style.backgroundImage = `url('${bgInner}')`;
});

// Double tap detection
document.addEventListener("touchend", (e) => {
  const now = Date.now();
  if (now - lastTap < 300) {
    const rect = clockCanvas.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    const radius = rect.width / 2;

    const touch = e.changedTouches[0];
    const distance = Math.hypot(touch.clientX - centerX, touch.clientY - centerY);

    if (distance <= radius) changeBackground("inner");
    else changeBackground("outer");
  }
  lastTap = now;
});

// Ganti background
function changeBackground(type) {
  bgUpload.onchange = async function(event) {
    const file = event.target.files[0];
    if (!file) return;

    if (file.type.startsWith("video/")) {
      await saveVideo(file); // simpan ke IndexedDB
      const url = URL.createObjectURL(file);
      setVideoBackground(url);
      localStorage.setItem("bgOuterType", "video"); 
    } else {
      // kalau gambar
      const reader = new FileReader();
      reader.onload = function(e) {
        const bgData = e.target.result;
        if (type === "outer") {
          setImageBackground(bgData);
          localStorage.setItem("bgOuter", bgData);
          localStorage.setItem("bgOuterType", "image");
        } else {
          clockBg.style.backgroundImage = `url('${bgData}')`;
          localStorage.setItem("bgInner", bgData);
        }
      };
      reader.readAsDataURL(file);
    }

    // Delay kecil biar fullscreen aman
    setTimeout(() => forceFullscreen(), 400);
  };

  bgUpload.click();
}

// Helper: set image bg
function setImageBackground(data) {
  if (videoEl) {
    videoEl.remove();
    videoEl = null;
  }
  document.body.style.backgroundImage = `url('${data}')`;
  document.body.style.backgroundSize = "cover";
  document.body.style.backgroundPosition = "center";
  document.body.style.backgroundRepeat = "no-repeat";
}

// Helper: set video bg
function setVideoBackground(url) {
  if (videoEl) videoEl.remove();

  videoEl = document.createElement("video");
  videoEl.src = url;
  videoEl.autoplay = true;
  videoEl.loop = true;
  videoEl.muted = true;
  videoEl.playsInline = true;
  videoEl.style = `
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    z-index: -1;
  `;

  document.body.style.backgroundImage = ""; // reset bg image
  document.body.appendChild(videoEl);
}

// Optional: klik gambar masuk fullscreen
const img = document.getElementById("thumb");
if (img) {
  img.addEventListener("click", () => {
    forceFullscreen();
  });
}

// ==================== PWA / INPUT ====================
function isInStandaloneMode() {
  return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone;
}
if (isInStandaloneMode()) {
  document.getElementById("bgUpload").style.display = "none";
}

// ==================== FALLBACK BACKGROUND ====================
window.addEventListener("DOMContentLoaded", async () => {
  const bgOuterType = localStorage.getItem("bgOuterType");
  const bgOuter = localStorage.getItem("bgOuter");
  const bgInner = localStorage.getItem("bgInner");

  if (bgOuterType === "image" && bgOuter) {
    setImageBackground(bgOuter);
  } else if (bgOuterType === "video") {
    const file = await loadVideo();
    if (file) {
      const url = URL.createObjectURL(file);
      setVideoBackground(url);
    }
  } else {
    // fallback default
    document.body.style.backgroundImage = `url('assets/bg.jpg')`;
  }

  if (bgInner) clockBg.style.backgroundImage = `url('${bgInner}')`;
});

// ==================== SMOOTH ENGINE 60FPS ====================
(function injectSmoothEngine() {
  const fps = 60;
  let ticking = true;
  let lastTime = performance.now();

  function loop() {
    if (!ticking) return;
    const now = performance.now();
    const delta = now - lastTime;

    if (delta >= 1000 / fps) {
      lastTime = now;
      document.dispatchEvent(new CustomEvent("pwaTick", { detail: { delta, now } }));
    }

    requestAnimationFrame(loop);
  }

  document.addEventListener("visibilitychange", () => {
    ticking = !document.hidden;
    if (ticking) lastTime = performance.now();
    if (ticking) loop();
  });

  console.log("â [Smooth Engine] Aktif");
  loop();
})();

// â Fallback aman untuk fungsi animasi
window.animateBackground ??= () => {};
window.animateVisualizer ??= () => {};
window.gerakinCoverArt ??= () => {};
window.updateCustomMeter ??= () => {};

// Tick listener tiap frame
document.addEventListener("pwaTick", (e) => {
  const { delta, now } = e.detail;
  animateBackground(delta);
  animateVisualizer(delta);
  gerakinCoverArt();
  updateCustomMeter(now);
});

// ==================== MEMORY ENGINE MAX ====================
window.loadedImages = [];

(function MemoryEngineMax() {
  console.log("â [Memory Engine Max] Aktif");

  const imagesToLoad = []; // bisa list preload di sini

  imagesToLoad.forEach((src) => {
    const img = new Image();
    img.src = src;
    img.onload = () => {
      window.loadedImages.push(img);
      console.log(`â Loaded: ${src}`);
    };
    img.onerror = () => console.warn(`â ï¸ Failed to load: ${src}`);
  });

  // bisa dipanggil manual buat inject ke elemen
  window.setBackgroundFromMemory = (index, targetElement) => {
    if (!window.loadedImages[index]) return;
    targetElement.style.backgroundImage = `url('${window.loadedImages[index].src}')`;
  };
})();

  
  window.addEventListener("resize", () => {
  document.documentElement.style.height = `${window.innerHeight}px`;
});
document.documentElement.style.height = `${window.innerHeight}px`;
  
  window.addEventListener('DOMContentLoaded', () => {
  const el = document.getElementById("visualMode");

  if (!el) {
    console.warn("Elemen #visualMode tidak ditemukan!");
    return;
  }

  console.log("ðµ Mode visual aktif!");

  // Tes tambahkan class manual satu-satu
  el.classList.add("dolby-vision");
  el.classList.remove("bravia-cinematic");
  el.classList.toggle("huawei-vivid");

  // Gabungan semuanya?
  el.classList.add("visual-mode-all");
});

function fixHeight() {
  const vh = window.innerHeight * 0.01;
  document.documentElement.style.setProperty('--vh', `${vh}px`);
}
window.addEventListener('resize', fixHeight);
fixHeight();

const lockBtn = document.getElementById("screenLockBtn");
const lockOverlay = document.getElementById("screenLockOverlay");

let isLocked = false;

function applyLockState() {
  if (isLocked) {
    lockOverlay.style.display = "block";
    lockBtn.textContent = "ð";
    lockBtn.title = "Buka kunci";
  } else {
    lockOverlay.style.display = "none";
    lockBtn.textContent = "ð";
    lockBtn.title = "Kunci layar";
  }
}

lockBtn.addEventListener("click", () => {
  isLocked = !isLocked;
  applyLockState();
});

// Auto lock saat halaman dimuat
window.addEventListener("load", () => {
  isLocked = true;
  applyLockState();
});

<!-- Panggil ini di bawah </body> -->
const weeklyQuotes = [
  // Minggu (0)
  {
    "09:00": {
      text: "Hari ini aku bangun dengan satu tujuan: mencintaimu lebih baik dari kemarin.",
      author: "- Najwa Shihab -"
    },
    "12:00": {
      text: "æã¯å¿ã®ä¸­ã§æãå¼·ãåã§ãã",
      author: "- Miyamoto Musashi -"
    },
    "22:00": {
      text: "Yang membekas dari lilin bukan lelehnya, kekasih, tapi wajahmu sebelum gelap.",
      author: "- Sujiwo Tejo -"
    }
  },
  // Senin (1)
  {
    "09:00": {
      text: "Your love is the first thought in my mind when I wake up.",
      author: "- Jane Austen -"
    },
    "12:00": {
      text: "Lâamore Ã¨ composto da unâunica anima che abita due corpi.",
      author: "- Aristotele -"
    },
    "22:00": {
      text: "ÐÑÐ±Ð¾Ð²Ñ Ð¿Ð¾Ð±ÐµÐ¶Ð´Ð°ÐµÑ Ð²ÑÐµ.",
      author: "- ÐÐ»ÐµÐºÑÐ°Ð½Ð´Ñ ÐÑÑÐºÐ¸Ð½ -"
    }
  },
  // Selasa (2)
  {
    "09:00": {
      text: "Setiap hari bersamamu adalah awal yang baru untuk mencintai lebih dalam.",
      author: "- Merry Riana -"
    },
    "12:00": {
      text: "Cinta bukan sekadar kata, tapi tindakan yang tak kenal lelah.",
      author: "- Soekarno -"
    },
    "22:00": {
      text: "Ketika malam datang dan kamu jauh dariku, hatiku tetap bersamamu.",
      author: "- Ludwig van Beethoven -"
    }
  },
  // Rabu (3)
  {
    "09:00": {
     text: "á½ÏÎ±Î½ á¼Î½Î±ÏÏá¿Ï Ïá½¸ ÏÏÏÎ¯, ÏÎºÎ­ÏÎ±Î¹ ÏÎ¯ ÏÏÎ¿ÏÎ´Î±á¿Î¿Î½ ÏÏá¾¶Î³Î¼Î± á¼ÏÏá½¶Î½ Î¶á¿Î½Â· ÏÎ½Îµá¿Î½, Î½Î¿Îµá¿Î½, á¼ÏÎ¿Î»Î±Î¼Î²Î¬Î½ÎµÎ¹Î½, á¼Î³Î±Ïá¾¶Î½.",
      author: "- Marcus Aurelius -"
    },
    "12:00": {
     text: "è¢«äººæ·±æ·±ç±çä¼ç»ä½ åéï¼æ·±æ·±å°ç±äººä¼ç»ä½ åæ°ã",
      author: "- Lao Tzu -"
    },
    "22:00": {
      text: "Let us always meet each other with smile, for the smile is the beginning of love.",
      author: "- Mother Teresa -"
    }
  },
  // Kamis (4)
  {
    "09:00": {
      text: "Kopi pagi ini terasa manis karena ada namamu yang ikut larut di pikiranku.",
      author: "- Wira Nagara -"
    },
    "12:00": {
      text: "àªªà«àª°à«àª® àª àªµàª¿àª¶à«àªµàª®àª¾àª àªàª¾àª£à«àª¤à« àª¸à«àª¥à« àª¶àªà«àª¤àª¿àª¶àª¾àª³à« àª¶àªà«àª¤àª¿ àªà«.",
      author: "- Mahatma Gandhi -"
    },
    "22:00": {
     text: "ÙÙØ³ ÙÙØ§Ù ÙØ§ ÙÙ Ø£Ø¬ÙÙ ÙÙ ØµÙØª Ø§ÙÙÙÙ Ø§ÙÙÙÙÙØ¡ Ø¨Ø§ÙØ¯Ø¹Ø§Ø¡ ÙØ§ÙØ­Ø¨.",
      author: "- Imam Al-Ghazali -"
    }
  },
  // Jumat (5)
  {
    "09:00": {
      text: "Jumat penuh berkah, dan berkah terbesarku adalah memilikimu.",
      author: "- K.H. Mustofa Bisri -"
    },
    "12:00": {
      text: "Bersamamu, bahkan diam di bawah matahari siang pun terasa teduh.",
      author: "- Dian Sastro -"
    },
    "22:00": {
     text: "ÙÙ Ø£Ø­Ø¨ ÙÙÙØ ÙØ³ØªÙÙØ£ ÙÙÙÙ Ø§ÙØ³ÙÙÙØ© ÙÙ Ø£Ø­Ø¶Ø§Ù Ø§ÙØ¯Ø¹Ø§Ø¡.",
      author: "- Syekh Abdul Qodir Jaelani -"
    }
  },
  // Sabtu (6)
  {
    "09:00": {
      text: "á¼Î½ á¿¥á¿Î¼Î± á¼¡Î¼á¾¶Ï á¼Î»ÎµÏÎ¸ÎµÏÎ¿á¿ á¼Ïá½¸ ÏÎ±Î½Ïá½¸Ï Î²Î¬ÏÎ¿ÏÏ ÎºÎ±á½¶ ÏÏÎ½Î¿Ï Ïá¿Ï Î¶Ïá¿ÏÂ· á¼ÎºÎµá¿Î½Î¿ Ïá½¸ á¿¥á¿Î¼Î± á¼Î³Î¬ÏÎ· á¼ÏÏÎ¯Î½.",
      author: "- Sophocles -"
    },
    "12:00": {
      text: "The more I give to thee, the more I have, for both are infinite.",
      author: "- William Shakespeare -"
    },
    "22:00": {
      text: "Amar no es mirarse el uno al otro, sino mirar juntos en la misma direcciÃ³n.",
      author: "- Antoine de Saint-ExupÃ©ry -"
    }
  }
];

let quotePlayedToday = {}; // buat tracking per waktu

function typeText(el, txt, baseSpeed = 400, onComplete = null) {
  el.textContent = "";
  let i = 0;

  function nextChar() {
    el.textContent += txt.charAt(i++);
    if (i < txt.length) {
      // Delay random Â±150ms agar lebih natural
      let speed = baseSpeed + Math.random() * 150 - 75;
      if (txt.charAt(i) === " ") speed /= 1.5; // spasi sedikit lebih cepat
      setTimeout(nextChar, speed);
    } else if (onComplete) {
      onComplete();
    }
  }

  nextChar();
}


function playQuoteSequence(quote, repeat = 2) {
  const textEl = document.getElementById("typedQuote");
  const authorEl = document.getElementById("quoteAuthor");
  let currentRepeat = 0;

  function runOnce() {
    typeText(textEl, quote.text, 100, () => {
      setTimeout(() => {
        typeText(authorEl, quote.author, 80, () => {
          setTimeout(() => {
            textEl.style.opacity = 0;
            authorEl.style.opacity = 0;

            setTimeout(() => {
              textEl.textContent = "";
              authorEl.textContent = "";
              textEl.style.opacity = 1;
              authorEl.style.opacity = 1;

              currentRepeat++;
              if (currentRepeat < repeat) {
                setTimeout(runOnce, 1000);
              }
            }, 800);
          }, 5000);
        });
      }, 300);
    });
  }

  runOnce();
}


function checkTimeForQuotes() {
  const now = new Date();
  const day = now.getDay();
  const h = String(now.getHours()).padStart(2,"0");
  const m = String(now.getMinutes()).padStart(2,"0");
  const timeKey = `${h}:${m}`;
  const todayQuotes = weeklyQuotes[day];
  if (!todayQuotes) return;
  const quote = todayQuotes[timeKey];
  if (quote && !quotePlayedToday[timeKey]) {
    quotePlayedToday[timeKey] = true;
    playQuoteSequence(quote);
  }
}

// Reset harian tiap 00:01
setInterval(() => {
  const now = new Date();
  if (now.getHours() === 0 && now.getMinutes() === 1) {
    quotePlayedToday = {};
    console.log("Reset harian");
  }
}, 60000);

document.addEventListener("DOMContentLoaded", () => {
  setInterval(checkTimeForQuotes, 60000);
  checkTimeForQuotes();
});

// ==================== Alarm Routine ====================
let audioReady = false;
let alarmTriggered = [false, false, false]; // status trigger untuk 3 waktu

document.addEventListener('click', () => {
  const alarm = document.getElementById('alarmSound');
  alarm.play().then(() => {
    alarm.pause();
    alarm.currentTime = 0;
    audioReady = true;
    console.log('â Audio di-unlock lewat klik');
  }).catch(err => console.warn('â Gagal unlock audio:', err));
}, { once: true });

const alarmTimes = [
  { hour: 9, minute: 0 },
  { hour: 12, minute: 0 },
  { hour: 22, minute: 0 }
];

const alarmKey = 'alarmTriggeredOnceEver';

setInterval(() => {
  const now = new Date();
  const h = now.getHours();
  const m = now.getMinutes();
  if (audioReady && !localStorage.getItem(alarmKey)) {
    alarmTimes.forEach((time, i) => {
      if (h === time.hour && m === time.minute) {
        const alarm = document.getElementById('alarmSound');
        alarm.play().then(() => console.log(`ð Alarm sekali seumur hidup: ${h}:${m}`));
        localStorage.setItem(alarmKey, 'true');
      }
    });
  }
}, 1000);

// Reset tiap jam
let lastCheckedHour = new Date().getHours();
setInterval(() => {
  const nowHour = new Date().getHours();
  if (nowHour !== lastCheckedHour) {
    alarmTriggered = [false,false,false];
    lastCheckedHour = nowHour;
    console.log('ð Reset alarmTriggered untuk jam baru');
  }
}, 60000);

// ==================== Queue system ====================
let isPlaying = false; // menandai quote sedang berjalan

function playQuoteOnce(quote, repeat = 2) {
  if (isPlaying) return; // block tap selama quote sedang berjalan
  isPlaying = true;

  // Jalankan sequence quote
  playQuoteSequence(quote, repeat);

  // Hitung durasi total sequence
  const textLen = quote.text.length;
  const authorLen = quote.author.length;
  const duration = ((textLen * 100 + 300) + (authorLen * 80 + 5000 + 800 + 1000)) * repeat;

  // Setelah selesai, aktifkan tap lagi
  setTimeout(() => {
    isPlaying = false;
  }, duration);
}

// ==================== Single Tap Random Quote + Ping ====================
let playedQuotesAll = []; // tracking semua quotes yang sudah dimainkan

document.body.addEventListener('click', () => {
  if (!audioReady || isPlaying) return;

  // Flatten weeklyQuotes jadi array semua quote
  const allQuotes = [];
  weeklyQuotes.forEach(dayQuotes => {
    Object.values(dayQuotes).forEach(quote => allQuotes.push(quote));
  });

  // Filter quotes yang belum dimainkan
  const remainingQuotes = allQuotes.filter(q => !playedQuotesAll.includes(q));

  // Kalau semua sudah dimainkan â reset
  if (remainingQuotes.length === 0) {
    playedQuotesAll = [];
    remainingQuotes.push(...allQuotes);
  }

  // Ambil random dari yang belum dimainkan
  const randomQuote = remainingQuotes[Math.floor(Math.random() * remainingQuotes.length)];

  // Tandai sudah dimainkan
  playedQuotesAll.push(randomQuote);

  // Play quote
  playQuoteOnce(randomQuote);

  // Bunyi ping
  const alarm = document.getElementById('alarmSound');
  alarm.play().catch(err => console.warn('â Gagal play ping:', err));
});


const visualEngineSettings = {
  postProcess: {
    exposure: {
      minBrightness: 0.8,
      maxBrightness: 1.2,
      autoAdjust: true,
      speed: 0.15
    },
    contrast: 1.15,
    saturation: 1.1,
    bloom: {
      enabled: true,
      intensity: 0.3,
      threshold: 1.1
    },
    vignette: {
      enabled: true,
      intensity: 0.15,
      smoothness: 0.6
    },
    chromaticAberration: {
      enabled: true,
      intensity: 0.02
    },
    motionBlur: {
      enabled: true,
      shutterAngle: 90
    },
    colorGrading: {
      lift: [1.0, 1.0, 1.0],
      gamma: [1.05, 1.05, 1.05],
      gain: [1.1, 1.1, 1.1]
    },
    lensFlare: {
      enabled: true,
      intensity: 0.2
    },
    ambientOcclusion: {
      enabled: true,
      radius: 0.5,
      intensity: 0.6
    },
    depthOfField: {
      enabled: true,
      focalDistance: 3.0,
      aperture: 2.8,
      blurAmount: 0.5
    }
  },
  skybox: {
    type: "gradient",
    topColor: "#1c1c2a",
    bottomColor: "#5c6c80"
  },
  lighting: {
    direction: [0.5, -1, 0.3],
    intensity: 1.0,
    color: "#ffffff",
    shadows: true
  },
  autoControl: {
    autoplay: true,
    loop: true,
    muted: false,
    volume: 1.0,
    controlsVisible: false
  }
};

  const canvas = document.getElementById("hiddenCanvas");

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
  camera.position.z = 5;

  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
  renderer.setSize(256, 256); // kecilin ukuran, cukup buat proses belakang layar

  // Buat object 3D
  const geometry = new THREE.BoxGeometry(2, 2, 2);
  const material = new THREE.MeshStandardMaterial({ color: 0x00ffcc });
  const cube = new THREE.Mesh(geometry, material);
  scene.add(cube);

  // Lighting
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5, 5, 5);
  scene.add(light);

  // Render loop (background)
  let frame = 0;
  function animate() {
    requestAnimationFrame(animate);
    cube.rotation.x += 0.01;
    cube.rotation.y += 0.01;

    renderer.render(scene, camera);

    if (++frame % 60 === 0) {
      console.log("ð¥ Background 3D rendering still active", frame);
    }
  }

  animate();
  

// ================= Snow + Birthday Medley =================
let snowManualEnabled = false;  
let snowAutoEnabled = false;  
let snowCanvas, ctx, snowflakes;  
let birthdayTriggered = localStorage.getItem('birthdayTriggered') === 'true';  
let munchkinTriggered = false;  

let trackIdx = 0;
const audio = new Audio();
let startY = 0;

function initSnow() {  
  if (snowCanvas) return;  
  snowCanvas = document.createElement("canvas");  
  document.body.appendChild(snowCanvas);  
  snowCanvas.style.position = "fixed";  
  snowCanvas.style.top = "0";  
  snowCanvas.style.left = "0";  
  snowCanvas.style.width = "100%";  
  snowCanvas.style.height = "100%";  
  snowCanvas.style.pointerEvents = "none";  
  snowCanvas.style.zIndex = "0"; 
  snowCanvas.width = window.innerWidth;  
  snowCanvas.height = window.innerHeight;  
  ctx = snowCanvas.getContext("2d");  

      const snowCount = 81;  
  snowflakes = Array.from({ length: snowCount }, () => ({  
    x: Math.random() * snowCanvas.width,  
    y: Math.random() * snowCanvas.height,  
    size: Math.random() * 2 + 1.5,  
        speed: Math.random() * 0.5 + 0.2,
        sparkle: Math.random(),
        sparkleSpeed: Math.random() * 0.03 + 0.015,
    flashChance: Math.random() * 0.1 + 0.05,  
        glowHue: Math.random() * 360,
        lightness: Math.random() * 30 + 50,
  }));  

  window.addEventListener("resize", () => {  
    snowCanvas.width = window.innerWidth;  
    snowCanvas.height = window.innerHeight;  
  });  
}  

function renderSnow() {  
  requestAnimationFrame(renderSnow);  
  if (!(snowManualEnabled || snowAutoEnabled)) {  
    if (ctx) ctx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);  
    return;  
  }  
  ctx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);  
  snowflakes.forEach(flake => {  
    flake.y += flake.speed;  
    if (flake.y > snowCanvas.height) flake.y = 0;  
    flake.sparkle += flake.sparkleSpeed;  
    if (flake.sparkle > 1) flake.sparkle = 0;  
            const flash = Math.random() < flake.flashChance ? 1 : 0;
const alpha = 0.05 + flake.sparkle * 0.7 + flash * 0.9;
    const sizeBoost = flake.size * (0.5 + flash * 0.7);  

    const hue = (flake.glowHue + Date.now() * 0.02) % 360; // hue shift
            const light = flake.lightness;
    
    ctx.fillStyle = `hsla(${hue}, 100%, 80%, ${alpha})`;  
    ctx.shadowColor = `hsla(${hue}, 100%, 80%, ${alpha})`;  
            ctx.shadowBlur = 20 + 30 * flake.sparkle + flash * 40;
            
// flake utama
ctx.beginPath();
ctx.arc(flake.x, flake.y, sizeBoost, 0, Math.PI * 2);
ctx.fill();

// inner glow
ctx.beginPath();
ctx.arc(flake.x, flake.y, sizeBoost * 0.4, 0, Math.PI * 2);
ctx.fill();
  }); 
} 


// ==================== AUDIO INIT ====================
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let trackSource = null;
let convolver = null;
let stereoPanner = null;
let stereoGain = null;
let crossfeed = null;
let panTimer = null;
let eqNodes = [];

// ==================== SETUP EQ ====================
function setupEQ() {
  eqNodes = [];

  const low = audioCtx.createBiquadFilter();
  low.type = "lowshelf";
  low.frequency.value = 120;
  low.gain.value = 3;
  eqNodes.push(low);

  const mid = audioCtx.createBiquadFilter();
  mid.type = "peaking";
  mid.frequency.value = 1000;
  mid.Q.value = 1;
  mid.gain.value = 2;
  eqNodes.push(mid);

  const high = audioCtx.createBiquadFilter();
  high.type = "highshelf";
  high.frequency.value = 5000;
  high.gain.value = 5;
  eqNodes.push(high);
}

// ==================== LOAD REVERB ====================
async function setupReverb() {
  try {
    const resp = await fetch("assets/ir_hall.wav");
    const arrayBuffer = await resp.arrayBuffer();
    const irBuffer = await audioCtx.decodeAudioData(arrayBuffer);

    convolver = audioCtx.createConvolver();
    convolver.buffer = irBuffer;
    console.log("â Reverb siap");
  } catch(e) {
    console.warn("â  Gagal load reverb:", e);
  }
}

// ==================== CONNECT AUDIO NODES ====================
function connectAudioNodes(source) {
  if (!source) return;

  let node = source;

  // --- EQ chain ---
  eqNodes.forEach(n => {
    node.connect(n);
    node = n;
  });

  // --- Reverb utama ---
  if (convolver) {
    const convolverGain = audioCtx.createGain();
    convolverGain.gain.value = 0.25;
    node.connect(convolver);
    convolver.connect(convolverGain);
    convolverGain.connect(audioCtx.destination); // tetap bisa kedengeran reverb
  }

  // --- Stereo Pan ---
  stereoPanner = audioCtx.createStereoPanner();
  node.connect(stereoPanner);

  // --- Stereo Gain ---
  stereoGain = audioCtx.createGain();
  stereoGain.gain.value = 0.9; // safe, masih bisa dinaikin
  stereoPanner.connect(stereoGain);

  // --- Compressor ---
  const compressor = audioCtx.createDynamicsCompressor();
  compressor.threshold.setValueAtTime(-3, audioCtx.currentTime);
  compressor.knee.setValueAtTime(8, audioCtx.currentTime);
  compressor.ratio.setValueAtTime(3, audioCtx.currentTime);
  compressor.attack.setValueAtTime(0.03, audioCtx.currentTime);
  compressor.release.setValueAtTime(0.25, audioCtx.currentTime);
  stereoGain.connect(compressor);

  // --- Master Gain + Limiter ---
  const masterGain = audioCtx.createGain();
  masterGain.gain.value = 1.3; // lebih aman, limiter akan handle puncak
  compressor.connect(masterGain);

  const limiter = audioCtx.createDynamicsCompressor();
  limiter.threshold.setValueAtTime(-2, audioCtx.currentTime);
  limiter.knee.setValueAtTime(0.1, audioCtx.currentTime);
  limiter.ratio.setValueAtTime(20, audioCtx.currentTime);
  limiter.attack.setValueAtTime(0.001, audioCtx.currentTime);
  limiter.release.setValueAtTime(0.05, audioCtx.currentTime);

  masterGain.connect(limiter);
  limiter.connect(audioCtx.destination);

  // --- Crossfeed (via limiter juga) ---
  crossfeed = audioCtx.createGain();
  crossfeed.gain.value = 0.03;
  stereoGain.connect(crossfeed);
  crossfeed.connect(limiter); // ke limiter, supaya gak clipping

  // --- Polyphonic Tweak Max ---
  addPolyphonicTweakMax(stereoGain);

  // --- Slow Pan ---
  startSlowPan();

  console.log("ð¶ Audio nodes connected: EQ â Reverb â Pan â Gain â Compressor â Master â Limiter â Destination");
}

// ==================== MAXIMAL DESPERATE HORROR POLY ====================
let chorus = null;
let stereoDelay = null;
let extraReverb = null;
let lfo = null;
let pitchWobble = null;

function addPolyphonicTweakMax(node) {
    if (!node) return;

    // --- Chorus ---
    chorus = audioCtx.createDelay();
    chorus.delayTime.value = 0.03; // 30ms dreamy
    const chorusGain = audioCtx.createGain();
    chorusGain.gain.value = 0.2; // subtle

    node.connect(chorus);
    chorus.connect(chorusGain);
    chorusGain.connect(audioCtx.destination);

    // --- Stereo widen (tiny delay L-R) ---
    const splitter = audioCtx.createChannelSplitter(2);
    const merger = audioCtx.createChannelMerger(2);
    stereoDelay = audioCtx.createDelay();
    stereoDelay.delayTime.value = 0.025; // 25ms

    node.connect(splitter);
    splitter.connect(merger, 0, 0); // left normal
    splitter.connect(stereoDelay);
    stereoDelay.connect(merger, 0, 1); // right delayed

    const widenGain = audioCtx.createGain();
    widenGain.gain.value = 0.45;
    merger.connect(widenGain);
    widenGain.connect(audioCtx.destination);

    // --- Extra subtle reverb send ---
    if (convolver) {
        extraReverb = audioCtx.createGain();
        extraReverb.gain.value = 0.25; // sedikit naik
        node.connect(extraReverb);
        extraReverb.connect(convolver);
    }

    // --- LFO slow pan untuk ambience ---
    if (!stereoPanner) stereoPanner = audioCtx.createStereoPanner();
    node.connect(stereoPanner);

    lfo = audioCtx.createOscillator();
    const lfoGain = audioCtx.createGain();
    lfo.frequency.value = 0.015; // super slow, creepy
    lfoGain.gain.value = 0.3;
    lfo.connect(lfoGain);
    lfoGain.connect(stereoPanner.pan);
    lfo.start();

    // --- Pitch/Itch Wobble ---
    const wobbleOsc = audioCtx.createOscillator();
    const wobbleGain = audioCtx.createGain();
    wobbleOsc.type = "triangle";
    wobbleOsc.frequency.value = 0.8; // fast subtle
    wobbleGain.gain.value = 0.002; // tiny pitch deviation
    wobbleOsc.connect(wobbleGain);
    wobbleGain.connect(node.detune || node.frequency || node.playbackRate); // support depending node type
    wobbleOsc.start();
    pitchWobble = wobbleOsc;

    console.log("ð Polyphonic desperate horror tweak maximal aktif (chorus + widen + reverb + LFO + itch wobble)");
}

// ==================== SLOW PAN ====================
let panPos = 0;
let panDir = 1;
function startSlowPan() {
  stopSlowPan();
  if (!stereoPanner) return;

  panPos = 0;
  panDir = 1;

  panTimer = setInterval(() => {
    panPos += panDir * 0.0015;
    if (panPos > 0.35 || panPos < -0.35) panDir *= -1;
    stereoPanner.pan.setValueAtTime(panPos, audioCtx.currentTime);
  }, 30);
}

function stopSlowPan() {
  if (panTimer) clearInterval(panTimer);
  panTimer = null;
}

// ==================== DYNAMIC TRACKS ====================
const ONLINE_LINKS = [
  "https://raw.githubusercontent.com/yuda2525/jamY-Z/main/happy_birthday_medley.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamY-Z/main/Once%20Upon%20a%20December-Anastasia.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamY-Z/main/The%20Promised%20Neverland.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamY-Z/main/Wiegenlied%20(Lullaby)-Brahms.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamY-Z/main/Air%20on%20the%20G%20String-Johann%20Sebastian%20Bach.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamY-Z/main/twinkle-twinkle-little-star.mp3",
  "https://raw.githubusercontent.com/yuda2525/jamY-Z/main/Passacaglia-Handel-Halvorsen%20%5BMusic%20Box%5D.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamY-Z/main/Nocturne%20op.9%20No.2-Chopin.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamY-Z/main/Auld%20Lang%20Syne%20(The%20New%20Year's%20Anthem).m4a",

  // repo jamYZ (harus RAW juga)
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/Mariage%20D'amour%20(Wedding%20of%20Love)-Richard%20Clayderman.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/Canon%20in%20D-Johann%20Pachelbel.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/Davy%20Jones-Pirates%20of%20the%20Caribbean.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/It%E2%80%99s%20a%20small%20world-Walt%20Disney.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/Greensleeves-English%20Folk%20Song.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/Hide%20and%20Seek-Ho-ong-i%20feat.%20SeeU.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/Hymne%20%C3%A0%20l'amour-%C3%89dith%20Piaf.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/La%20Vie%20En%20Rose.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/Memories.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/Old%20Doll-Amacha%20Music%20Studio.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/Over%20the%20Rainbow.m4a",
  "https://raw.githubusercontent.com/yuda2525/jamYZ/main/Toreador%20Song-Bizet%20.m4a"
];

// Auto generate TRACKS array
const TRACKS = ONLINE_LINKS.map(url => {
  const fileName = url.split("/").pop();
  const baseName = fileName.replace(/\.[^/.]+$/, ""); // buang ekstensi
  return {
    online: url,
    offline: `assets/${baseName}.mp3`
  };
});

console.log(TRACKS);

// ==================== OFFLINE BUFFERS ====================
const offlineBuffers = {};
let currentPreload = 0;
let shuffledTracks = [];
let shuffleIdx = 0;

// ==================== SHUFFLE ====================
function shuffleTracks() {
  shuffledTracks = [...TRACKS];
  for (let i = shuffledTracks.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledTracks[i], shuffledTracks[j]] = [shuffledTracks[j], shuffledTracks[i]];
  }
  shuffleIdx = 0;
}

// ==================== PRELOAD TRACK ====================
async function preloadTrack(track) {
  if (!track.offline) return console.warn("â  track.offline undefined:", track.online);
  if (offlineBuffers[track.offline]) return; // sudah preload

  try {
    const resp = await fetch(track.offline);
    if (!resp.ok) throw new Error("File offline tidak ditemukan");
    const arrayBuffer = await resp.arrayBuffer();
    if (arrayBuffer.byteLength === 0) throw new Error("ArrayBuffer kosong");
    offlineBuffers[track.offline] = await audioCtx.decodeAudioData(arrayBuffer);
    console.log("â Preloaded offline:", track.offline);
  } catch(e) {
    console.warn("â  Gagal preload offline:", track.offline, e);
  }
}

// ==================== PRELOAD NEXT ====================
async function preloadNextTrack() {
  if (currentPreload >= TRACKS.length) return;
  await preloadTrack(TRACKS[currentPreload++]);
  setTimeout(preloadNextTrack, 50);
}

// ==================== UNLOCK AUDIO ====================
document.addEventListener('click', async () => {
  if (!audioReady) {
    await audioCtx.resume();
    audioReady = true;
    console.log("â AudioContext unlocked, mulai preload offline");
    preloadNextTrack();
  }
}, { once: true });

// ==================== PLAY BUFFER ====================
function playTrackBuffer(buffer) {
  if (trackSource) {
    trackSource.stop();
    trackSource.disconnect();
    trackSource = null;
  }

  trackSource = audioCtx.createBufferSource();
  trackSource.buffer = buffer;
  trackSource.connect(audioCtx.destination);
  trackSource.start();
  trackSource.onended = () => { trackSource = null; console.log("â Track selesai"); };
}

// ==================== PLAY RANDOM OFFLINE-FIRST ====================
async function playRandomTrackSafe() {
  if (!audioReady) return console.warn("â  Audio belum unlock");
  if (shuffleIdx >= shuffledTracks.length) shuffleTracks();
  const current = shuffledTracks[shuffleIdx++];

  let bufferToPlay = offlineBuffers[current.offline];

  if (!bufferToPlay) {
    console.warn("â  Offline buffer belum siap, fallback online:", current.online);
    try {
      const resp = await fetch(current.online);
      const arrayBuffer = await resp.arrayBuffer();
      bufferToPlay = await audioCtx.decodeAudioData(arrayBuffer);
      console.log("â  Played online fallback:", current.online);
    } catch(e) {
      return console.error("â Audio gagal play:", current.online, e);
    }
  }

  playTrackBuffer(bufferToPlay);

  if (currentPreload < TRACKS.length) setTimeout(preloadNextTrack, 50);
}

// ==================== PLAY SINGLE TRACK ====================
async function playTrack(url, fallbackUrl) {
  let bufferToPlay = offlineBuffers[fallbackUrl];

  if (!bufferToPlay) {
    try {
      const resp = await fetch(url);
      const arrayBuffer = await audioCtx.decodeAudioData(await resp.arrayBuffer());
      bufferToPlay = arrayBuffer;
      console.log("â  Played online single track");
    } catch {
      if (!bufferToPlay) return console.error("â Audio gagal play single track");
    }
  }

  playTrackBuffer(bufferToPlay);
}

// ==================== SWIPE SNOW HANDLER ====================
document.body.addEventListener("touchstart", e => startY = e.touches[0].clientY);
document.body.addEventListener("touchend", e => {
  const endY = e.changedTouches[0].clientY;
  if (startY - endY > 50) { // swipe up
    if (!snowAutoEnabled) {
      snowAutoEnabled = true;
      snowManualEnabled = true;
      console.log("â Snow ON + random track play");
      playRandomTrackSafe();
    } else {
      snowAutoEnabled = false;
      snowManualEnabled = false;

      // stop audio
      if (trackSource) {
        trackSource.stop();
        trackSource.disconnect();
        trackSource = null;
      }

      // stop pan
      stopSlowPan();

      // bersihkan snow canvas
      if (ctx) ctx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);

      console.log("â Snow OFF + audio STOP");
    }
  }
});

// ==================== INIT SNOW ====================
initSnow();
renderSnow();
setupReverb();
setupEQ();


// ==================== DROPDOWN + USER GUIDE + WELCOME ====================
(function() {
  const WELCOME_KEY = 'welcomeShown';
  const BIRTHDAY_KEY = 'userBirthdays';

  // ==== HELPER POPUP DROPDOWN ====
  function createPopup(content, autoHide = 5000) {
    const popup = document.createElement('div');
    popup.innerHTML = content;
    popup.style = `
      position: fixed;
      top: 10%; left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.85);
      color: #fff;
      padding: 20px;
      border-radius: 12px;
      max-width: 90%;
      text-align: center;
      font-family: sans-serif;
      z-index: 9999;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    `;
    document.body.appendChild(popup);
    if(autoHide) setTimeout(()=>popup.remove(), autoHide);
    return popup;
  }

  // ==== LOCK PAGE INTERACTION ====
  function lockPage() {
    const lock = document.createElement('div');
    lock.id = 'pageLock';
    lock.style.cssText = `
      position: fixed; top:0; left:0;
      width:100vw; height:100vh;
      z-index:2147483645;
      background: rgba(0,0,0,0);
    `;
    document.body.appendChild(lock);
  }

  function unlockPage() {
    const lock = document.getElementById('pageLock');
    if(lock) lock.remove();
  }

  // ==== WELCOME ANIMATION ====
  function showWelcomeAnimation(callback) {
    if(localStorage.getItem(WELCOME_KEY)) {
      if(callback) callback();
      return;
    }

    lockPage(); // lock interaksi

    const container = document.createElement('div');
    container.style.cssText = `
      position: fixed; top:0; left:0;
      width:100vw; height:100vh;
      background: #000;
      opacity: 0;
      transition: opacity 2s;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
      z-index: 2147483644;
      font-family: 'Courier New', monospace;
      overflow: hidden;
    `;
    document.body.appendChild(container);

    requestAnimationFrame(()=> container.style.opacity = 1);
    setTimeout(()=> startWelcome(container, callback), 2000);
  }

  function startWelcome(container, callback) {
    // TITLE
    const title = document.createElement('h1');
    title.style.cssText = `
      font-size:2em; margin:0 20px; opacity:1;
      letter-spacing: 2px; color:#0ff;
      text-shadow: 0 0 5px #0ff,0 0 10px #0ff,0 0 20px #0ff,0 0 30px #0ff;
      word-break: break-word; text-align: center;
    `;
    container.appendChild(title);

    // SUBTITLE
    const subtitle = document.createElement('div');
    subtitle.style.cssText = `
      font-size:1.2em; margin:20px; color:#0ff;
      text-shadow: 0 0 3px #0ff,0 0 7px #0ff;
      word-break: break-word; text-align: center;
    `;
    container.appendChild(subtitle);

    const paragraphs = [
      'Semoga anda dapat memaximalkan semua fitur yang telah kami sediakan.',
      'Jangan lupa, like, coment, follow, dan support kami, di semua media sosial kami.',
      'Kami tunggu masukan dan saran kreatif dari anda.',
      'Tanpa anda, kami "is nothing."',
      '- CorE-YÂ², 2025 -'
    ];

    // TYPEWRITER TITLE
    const titleText = 'Hallo, selamat datang di dunia interaktiv kami!';
    let tIndex = 0;
    function typeTitleChar() {
      if(tIndex < titleText.length) {
        title.textContent += titleText[tIndex++];
        setTimeout(typeTitleChar, 150);
      } else typeSubtitle(0);
    }
    typeTitleChar();

    // TYPEWRITER PARAGRAPH
    function typeSubtitle(index) {
      if(index >= paragraphs.length) return startFadeOut();
      const p = document.createElement('p');
      subtitle.appendChild(p);
      let charIndex = 0;
      const text = paragraphs[index];

      function typeChar() {
        if(charIndex < text.length) {
          p.textContent += text[charIndex++];
          setTimeout(typeChar, 60);
        } else setTimeout(()=> typeSubtitle(index+1), 600);
      }
      typeChar();
    }

    // PARTICLE NEON
    const vw = window.innerWidth;
    const vh = window.innerHeight;
    const particleCount = 60;
    const particles = [];
    for(let i=0;i<particleCount;i++){
      const p = document.createElement('div');
      const isDot = Math.random()<0.5;
      const startX = Math.random()*vw;
      const startY = Math.random()*vh;
      const hue = Math.floor(Math.random()*360);
      p.style.cssText = `
        position:absolute;
        width:${isDot?3:2}px; height:${isDot?3:8}px;
        border-radius:${isDot?'50%':'1px'};
        left:0; top:0;
        background:hsl(${hue},100%,70%);
        pointer-events:none; opacity:0.8;
        transform:translate3d(${startX}px,${startY}px,0);
      `;
      container.appendChild(p);
      particles.push({el:p,x:startX,y:startY,vx:(Math.random()-0.5)*2,vy:Math.random()*1+0.5,life:Math.random()*600+400,blinkRate:Math.random()*0.2+0.05});
    }

    function animateParticles() {
      particles.forEach(p=>{
        if(p.life<=0 || p.y>vh){
          p.x = Math.random()*vw; p.y=-10;
          p.vx=(Math.random()-0.5)*2;
          p.vy=Math.random()*1+0.5;
          p.life=Math.random()*600+400;
        }
        p.x+=p.vx; p.y+=p.vy;
        p.el.style.transform = `translate3d(${p.x}px,${p.y}px,0)`;
        p.el.style.opacity = Math.random()<p.blinkRate?0:0.8;
        p.life--;
      });
      requestAnimationFrame(animateParticles);
    }
    animateParticles();

    // FADE OUT
    function startFadeOut() {
      setTimeout(()=>{
        container.style.transition = 'opacity 2s';
        container.style.opacity = 0;
        setTimeout(()=>{
          container.remove();
          localStorage.setItem(WELCOME_KEY,'true');
          unlockPage();
          if(callback) callback();
        },2000);
      },2000);
    }
  }

// ==== MINI DROPDOWN MENU ====
function createDropdownMenu() {
  const icon = document.createElement('div');
  icon.innerHTML = 'ð';
  icon.style.cssText = `
    position: fixed; top: 15px; left: 15px;
    font-size: 18px; cursor: pointer;
    z-index: 9999;
  `;
  document.body.appendChild(icon);

  const menu = document.createElement('div');
  menu.style.cssText = `
    position: fixed; top: 45px; left: 15px;
    background: rgba(0,0,0,0.85);
    color: #fff;
    border-radius: 10px;
    padding: 10px;
    display: none;
    flex-direction: column;
    font-family: sans-serif;
    z-index: 9999;
    min-width: 160px;
  `;
  menu.innerHTML = `
    <button id="clearDataBtn" style="margin:5px;">Clear Data</button>
    <button id="clearCacheBtn" style="margin:5px;">Clear Cache</button>
    <button id="userGuideBtn" style="margin:5px;">User Guide</button>
    <button id="addBirthdayBtn" style="margin:5px;">Tambah Ultah</button>
  `;
  document.body.appendChild(menu);

  icon.addEventListener('click', () => menu.style.display = menu.style.display==='flex'?'none':'flex');

  menu.querySelector('#clearDataBtn').addEventListener('click', ()=> {
    localStorage.clear();
    createPopup('â Data berhasil dihapus',3000);
  });

  menu.querySelector('#clearCacheBtn').addEventListener('click', ()=> {
    if(window.caches){
      caches.keys().then(keys=>keys.forEach(k=>caches.delete(k)));
    }
    createPopup('â Cache berhasil dihapus',3000);
  });

  menu.querySelector('#userGuideBtn').addEventListener('click', showUserGuide);

  menu.querySelector('#addBirthdayBtn').addEventListener('click', ()=> {
    // FORM overlay untuk tambah ultah
    const overlay = document.createElement('div');
    overlay.style.cssText = `
      position: fixed; top:0; left:0; width:100vw; height:100vh;
      background: rgba(0,0,0,0.95);
      display: flex; justify-content: center; align-items: center;
      z-index: 99999; font-family: sans-serif;
    `;

    const form = document.createElement('div');
    form.style.cssText = `
      background: #111; padding: 25px 30px; border-radius:12px;
      display:flex; flex-direction:column; align-items:flex-start;
      color:#fff; min-width:280px;
    `;

    form.innerHTML = `
      <h3 style="margin:0 0 15px 0;">ð Tambah Ultah</h3>
      <label>Nama:</label>
      <input type="text" id="birthdayName" style="margin-bottom:10px;width:100%;padding:5px;border-radius:5px;border:none;">
      <label>Tanggal:</label>
      <input type="date" id="birthdayDate" style="margin-bottom:15px;width:100%;padding:5px;border-radius:5px;border:none;">
      <div style="align-self:flex-end;">
        <button id="saveBirthdayBtn" style="margin-right:10px;padding:5px 10px;">Simpan</button>
        <button id="closeFormBtn" style="padding:5px 10px;">Batal</button>
      </div>
    `;
    overlay.appendChild(form);
    document.body.appendChild(overlay);

    overlay.querySelector('#closeFormBtn').addEventListener('click', ()=> overlay.remove());

    overlay.querySelector('#saveBirthdayBtn').addEventListener('click', ()=> {
      const name = overlay.querySelector('#birthdayName').value.trim();
      const date = overlay.querySelector('#birthdayDate').value;
      if(!name || !date) return alert('Nama & Tanggal wajib diisi');
      const birthdays = JSON.parse(localStorage.getItem(BIRTHDAY_KEY) || '[]');
      birthdays.push({name,date});
      localStorage.setItem(BIRTHDAY_KEY, JSON.stringify(birthdays));
      createPopup(`â Tersimpan: ${name} - ${date}`,3000);
      overlay.remove();
    });
  });
}

// ==== USER GUIDE FULLSCREEN ====
function showUserGuide() {
  const overlay = document.createElement('div');
  overlay.style.cssText = `
    position: fixed; top:0; left:0;
    width:100vw; height:100vh;
    background: rgba(0,0,0,0.95);
    color: #fff;
    font-family: sans-serif;
    z-index: 99999;
    display: flex; flex-direction: column;
    overflow-y: auto; padding: 20px;
  `;

  const closeBtn = document.createElement('button');
  closeBtn.textContent = 'â';
  closeBtn.style.cssText = `
    position: fixed; top:15px; right:20px;
    font-size:24px; background:none; border:none;
    color:#fff; cursor:pointer; z-index:100000;
  `;
  closeBtn.addEventListener('click', ()=> overlay.remove());
  overlay.appendChild(closeBtn);

  const content = document.createElement('div');
  content.innerHTML = `
    <h2>ð Panduan Pengguna</h2>
    <p>Terima kasih telah menggunakan aplikasi ini. Berikut beberapa panduan:</p>
    <ul style="text-align:left; margin:0; padding:0 10px 0 20px;">
      <li>ð¶ Ketuk area: mainkan quote & ping audio</li>
      <li>â Geser ke atas: aktifkan/nonaktifkan efek snow</li>
      <li>ð¼ Double tap pada jam: ganti background</li>
      <li>ð Icon gift: menu Clear Data, Clear Cache, User Guide, Tambah Ultah</li>
      <li>ð Birthday surprise otomatis sesuai tanggal yang tersimpan</li>
    </ul>
  `;
  overlay.appendChild(content);

  document.body.appendChild(overlay);
}

  // ==== BIRTHDAY SURPRISE CHECK ====
  function checkBirthdaySurprise() {
    const birthdays = JSON.parse(localStorage.getItem(BIRTHDAY_KEY) || '[]');
    const today = new Date();
    birthdays.forEach(b => {
      const d = new Date(b.date);
      if(d.getDate() === today.getDate() && d.getMonth() === today.getMonth()) {
        createPopup(`ð Selamat ulang tahun ${b.name}!!`, 7000);
        if(typeof playTrack === 'function') playTrack('hbd.mp3');
      }
    });
  }

  // ==== INIT ====
  window.addEventListener('load', () => {
    createDropdownMenu();
    if(!localStorage.getItem(WELCOME_KEY)) {
      showWelcomeAnimation(() => console.log('Welcome animation done'));
      localStorage.setItem(WELCOME_KEY, 'true');
    }
    setInterval(checkBirthdaySurprise, 60000);
  });

})();


  // Array tagline per hari MingguâSabtu
  const taglines = [
    "Ð¡ÑÐ°ÑÑÑÐµ Ð²Ð½ÑÑÑÐ¸ ÑÐµÐ±Ñ.",                     // Minggu â Rusia
    "Haz lo que amas.",                          // Senin â Spanyol
    "ç¸ä¿¡èªå·±",                                 // Selasa â Mandarin
    "ÙÙ Ø£ÙØ¶Ù ÙØ³Ø®Ø© ÙÙÙ",                          // Rabu â Arab
    "La vie est belle.",                         // Kamis â Prancis
    "ä»æ¥ãå¤§åã«",                               // Jumat â Jepang
    "Percaya, coba, dan wujudkan impianmu."     // Sabtu â Indonesia
  ];

  let today = new Date().getDay();
   // today = 4; // untuk tes manual, misal hari Kamis
  const dailyTagline = document.getElementById('daily-tagline');
  dailyTagline.textContent = taglines[today];

  // Animasi fade in/out loop
  const fadeDuration = 3000;   // durasi fade in/out (ms)
  const visibleDuration = 10000; // durasi tetap terlihat (ms)

  function fadeInOut(element) {
    // Fade in
    element.style.transition = `opacity ${fadeDuration}ms`;
    element.style.opacity = 1;

    // Setelah fade in + visibleDuration, fade out
    setTimeout(() => {
      element.style.opacity = 0;
    }, fadeDuration + visibleDuration);

    // Loop ulang
    setTimeout(() => {
      fadeInOut(element);
    }, fadeDuration*2 + visibleDuration);
  }

  // Mulai animasi
  fadeInOut(dailyTagline);


// buat footer di body, di luar container animasi
const footer = document.createElement('footer');
footer.style.cssText = `
  position: fixed;
  bottom: 2px;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  padding: 18px 12px;
  font-size: 0.40rem;
  color: #fff;
  background: rgba(0,0,0,0);
  font-family: sans-serif;
  -webkit-backdrop-filter: blur(10px);
  z-index: 9999;
`;

footer.innerHTML = `
  Â© 2025 <span class="brand">CorE-YÂ²</span> Â· Powered by AI & Human Creativity
  <br>
  <a href="mailto:yudabastard84@gmail.com" class="brand">yudabastard84@gmail.com</a>
`;

// animasi rainbow via JS
const style = document.createElement('style');
style.textContent = `
  @keyframes animateText {  
    0% { background-position: 0% 50%; }  
    50% { background-position: 100% 50%; }  
    100% { background-position: 0% 50%; }  
  }
  footer .brand {  
    font-weight: 600;
    background: linear-gradient(90deg,#00faff,#ff00e0,#00ff91,#ffd500,#ff00e0,#00faff);
    background-size: 400% 100%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: animateText 5s ease-in-out infinite;
  }
`;
document.head.appendChild(style);
document.body.appendChild(footer);


if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      const reg = await navigator.serviceWorker.register('./sw.js');
      console.log('â Service Worker terdaftar di:', reg.scope);

      // Kirim ping ke SW aktif (opsional)
      if (reg.active) {
        console.log('[Main] Kirim ping ke SW aktif');
        reg.active.postMessage('ping');
      }

      // Menerima balasan dari SW
      navigator.serviceWorker.addEventListener('message', (event) => {
        if (event.data?.type === 'quote-ready') {
          console.log('[Main] Quote siap dijalankan!');
          if (typeof jalankanQuote === 'function') {
            jalankanQuote();
          }
        }
      });

    } catch (err) {
      console.error('â Gagal mendaftarkan Service Worker:', err);
    }
  });
} else {
  console.warn('â ï¸ Browser tidak mendukung Service Worker');
}


    console.log("â Script Loaded");      
  </script>      
</body>      
</html>      
      






